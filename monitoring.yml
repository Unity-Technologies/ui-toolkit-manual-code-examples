title: ads-kotlin-service-template
service: ads-kotlin-service-template

### Add more panels when related functionality is added to code
# incoming nats messages by subject
# nats_server -> find.***, find-one.*** etc
# nats_subscriber -> pub.***

# outgoing nats messages by subject
# nats_client -> find.***, find-one.*** etc
# nats_publisher -> ack.***, retry.***, pub.***

# incoming http by route and verb
# http_server

# outgoing http by host and verb
# http_client

panels:
  - kind: custom
    from: ./monitoring/pods.json

  - kind: custom
    from: ./monitoring/jvm.json

  - kind: nats_server
    blocks:
      details:
        collapse: true

annotations:
  - kind: deployments

#alerts:
  # Memory Usage is at 90% of limit
#  - kind: custom
#    name: TODO_SERVICE_NAME_memory_cap
#    expr: (avg(container_memory_usage_bytes{container="{{service-container}}", environment="prd"}) / avg(kube_pod_container_resource_limits{container="{{service-container}}", environment="prd", resource="memory", unit="byte"}) * 100) > 90
#    severity: slack
#    receiver: TODO_RECEIVER_NAME
#    for: 5m
#    annotations:
#      summary: Memory usage is at {{ $value }}% of maximum for the past 5 minutes.
#      description: Service is running out of memory

  # Container restart threshold
#  - kind: custom
#    name: TODO_SERVICE_NAME_pod_restarts
#    expr: sum((rate(kube_pod_container_status_restarts_total{environment="prd", container="{{service-container}}"}[10m]) * 600)) > 2
#    severity: slack
#    receiver: TODO_RECEIVER_NAME
#    for: 1m
#    annotations:
#      summary: Container restart threshold exceeded
#      description: Containers restarted more than 2 times in the last 10 minutes.
